// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  plan      String   @default("free") // free, pro, enterprise
  qrLimit   Int      @default(10)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  qrCodes QRCode[]
  scans   Scan[]

  @@map("users")
}

model QRCode {
  id          String   @id @default(cuid())
  userId      String
  name        String
  data        String // URL, text, WiFi, contact data
  type        String // url, text, wifi, contact
  shortCode   String   @unique @default(cuid())
  styleConfig String   @default("{}") // JSON string for styling
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user  User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  scans Scan[]

  @@map("qr_codes")
}

model Scan {
  id         String   @id @default(cuid())
  qrId       String
  ipAddress  String?
  userAgent  String?
  country    String?
  city       String?
  referrer   String?
  deviceType String? // mobile, desktop, tablet
  browser    String?
  os         String?
  scannedAt  DateTime @default(now())

  // Relations
  qrCode QRCode  @relation(fields: [qrId], references: [id], onDelete: Cascade)
  user   User?   @relation(fields: [userId], references: [id])
  userId String?

  @@map("scans")
}

// Analytics views for better performance
model DailyStats {
  id          String   @id @default(cuid())
  qrId        String
  date        DateTime
  totalScans  Int      @default(0)
  uniqueScans Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([qrId, date])
  @@map("daily_stats")
}
